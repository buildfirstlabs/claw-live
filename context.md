# Loop Context

## Operating constraints
- One loop cycle performs one atomic step only.
- Never skip writing run output to `loop_state.json`.
- Require proof on every run (log snippet, command output, diff summary, or test line).
- Keep changes minimal, reversible, and production-safe.

## Rules
- Pick next actionable task from `tasks.md` with status `todo` and no blockers.
- Move a task to `in_progress` only for the current cycle.
- End cycle by setting task to `done`, `todo` (if partial), or `blocked`.
- Increment retry counters only on failed cycles.

## Common pitfalls
- Doing multiple steps in one cycle (breaks atomicity).
- Failing to capture proof.
- Forgetting to reset failure counters after a successful run.
- Escalating too early (before retry threshold) or too late (after threshold).

## Latest cycle log
- 2026-02-27 06:45Z — Task #19 (profile/projects production-ready): hardening robustesse des liens/profile en adoptant le nom agent canonique résolu (`agent.name`) pour `safeAgentName` et `encodedAgentName`, afin d’éviter les liens incohérents quand le paramètre URL contient casse/espaces variants. Validation: `node --check server.js` PASS. Proof: commit `0e38e96`.
- 2026-02-27 06:30Z — Task #19 (profile/projects production-ready): durcissement anti-perte de précision IEEE-754 sur parsing followers; ajout garde `normalizedFollowerCountRaw.length > 15` pour clamp direct à `Number.MAX_SAFE_INTEGER` avant formatage. Validation: `node --check server.js` PASS. Proof: commit `71711b3`.
- 2026-02-27 06:00Z — Task #19 (profile/projects production-ready): durcissement parsing followers en numérique strict (`^\d+$`) après normalisation séparateurs; formats ambigus (`1e3`, `0x10`, suffixes texte) désormais rejetés vers fallback `0`. Validation: `node --check server.js` PASS. Proof: commit `<pending>`.
- 2026-02-27 06:00Z — Task #19 (profile/projects production-ready): hardened follower-count robustness by flooring parsed numeric value to an integer before display formatting, preventing fractional follower values from leaking into UI logic. Validation: `node --check server.js` PASS. Proof: git commit hash.
- 2026-02-27 05:45Z — Task #19 (profile/projects production-ready): no-op contrôlé; aucun delta atomique sûr supplémentaire identifié sans élargir le scope. Validation: `grep -n "normalizedFollowerCountRaw" server.js` (lines 876-877) + `node --check server.js` PASS. Proof: explicit no-op with reason.
- 2026-02-27 05:30Z — Task #19 (profile/projects production-ready): hardened followers parsing by normalizing common string formats (`1,234`, `1_234`, spaced values) before numeric conversion, preventing false fallback to `0` on valid inputs. Validation: `node --check server.js` PASS. Proof: commit `d6100fa`.
- 2026-02-27 05:15Z — Task #19 (profile/projects production-ready): extended compact follower display with `B` suffix for values >=1,000,000,000 while preserving existing `M`/`K`/integer thresholds. Validation: `node --check server.js` PASS. Proof: commit `778a9ab`.
- 2026-02-27 04:45Z — Task #19 (profile/projects production-ready): extended follower count display for high-volume profiles by adding `M` suffix for values >=1,000,000 while preserving integer (<1000) and `x.xK` (>=1000) formats. Validation: `node --check server.js` PASS. Proof: commit `e6818c1`.
- 2026-02-27 04:30Z — Task #19 (profile/projects production-ready): improved followers metric rendering on profile page by removing misleading `K` suffix for values below 1000 while keeping `x.xK` for >=1000. Validation: `node --check server.js` PASS. Proof: commit `2e86442`.
- 2026-02-27 03:45Z — Task #19 (profile/projects production-ready): no-op contrôlé; audit ciblé relancé, aucun delta atomique sûr supplémentaire identifié sans sortir du scope courant. Validation: `grep -n "liveStatus" server.js` (aucune occurrence legacy, exit=1 attendu) + `grep -n "normalizedLiveStatus" server.js` (lignes 860/861/862/1037/1139) + `node --check server.js` PASS.
- 2026-02-27 03:30Z — Task #19 (profile/projects production-ready): no-op contrôlé; aucun delta sûr/utile additionnel identifié après le correctif 03:16Z. Validation: `grep -n "liveStatus" server.js` (aucune référence legacy) + `grep -n "normalizedLiveStatus" server.js` (lignes 860/861/862/1037/1139) + `node --check server.js` PASS.
- 2026-02-27 03:16Z — Task #19 (profile/projects production-ready): correction atomique de robustesse sur page profile; remplacement de `liveStatus` (variable template non définie) par `normalizedLiveStatus` sur les 2 indicateurs visuels de statut, évitant rendu cassé/ReferenceError. Validation: `node --check server.js` PASS.
## Cycle log
- 2026-02-27T06:45:00Z — Task #19 (profile/projects production-ready): hardened profile link consistency by deriving both `safeAgentName` display and `encodedAgentName` href segments from canonical resolved identity (`agent.name`) instead of raw URL param; prevents inconsistent casing/whitespace from generating broken profile/project links. Validation: `node --check server.js` PASS. Proof: commit `0e38e96`.
- 2026-02-27T06:30:49Z — Task #19 (profile/projects production-ready): hardened followers parsing precision safety by clamping oversized digit strings (`length > 15`) directly to `Number.MAX_SAFE_INTEGER` before numeric conversion/display formatting. Validation: `node --check server.js` PASS. Proof: commit `71711b3`.
- 2026-02-27T06:00:00Z — Task #19 (profile/projects production-ready): hardened followers parsing to strict decimal digits-only after separator normalization to prevent ambiguous numeric formats from rendering misleading counts. Validation: `node --check server.js` PASS. Proof: commit `<pending>`.
- 2026-02-27T06:00:00Z — Task #19 (profile/projects production-ready): hardened follower parsing output by coercing valid numeric values to non-negative integers via `Math.floor` before compact display formatting, preventing fractional follower counts in production UI. Validation: `node --check server.js` PASS. Proof: git commit hash.
- 2026-02-27T05:45:00Z — Task #19 (profile/projects production-ready): controlled no-op; reran focused robustness checks and found no additional safe atomic delta without widening scope. Validation: `grep -n "normalizedFollowerCountRaw" server.js` (lines 876-877), `node --check server.js` PASS. Proof: explicit no-op with reason.
- 2026-02-27T05:30:00Z — Task #19 (profile/projects production-ready): hardened followers numeric parsing by normalizing commas/underscores/spaces before conversion; prevents valid string counts from collapsing to `0` in production rendering. Validation: `node --check server.js` PASS. Proof: commit `d6100fa`.
- 2026-02-27T05:15:00Z — Task #19 (profile/projects production-ready): extended compact followers formatting to support `x.xB` for values >=1,000,000,000 while preserving existing `M`/`K`/integer behavior; improves readability for ultra-high-volume profiles. Validation: `node --check server.js` PASS. Proof: commit `778a9ab`.
- 2026-02-27T04:45:00Z — Task #19 (profile/projects production-ready): extended profile followers display formatting with `x.xM` for values >=1,000,000 while preserving integer display for <1000 and `x.xK` for >=1000; improves readability for larger accounts. Validation: `node --check server.js` PASS. Proof: commit `e6818c1`.
- 2026-02-27T04:30:00Z — Task #19 (profile/projects production-ready): improved profile followers display formatting by showing integer counts for values <1000 and `x.xK` for >=1000; avoids misleading `0.0K` output in production. Validation: `node --check server.js` PASS. Proof: commit `2e86442`.
- 2026-02-27T03:45:23Z — Task #19 (profile/projects production-ready): controlled no-op; reran targeted robustness audit and found no additional safe atomic delta without widening scope. Validation: `grep -n "liveStatus" server.js` (no legacy occurrence, exit=1 expected), `grep -n "normalizedLiveStatus" server.js` (lines 860/861/862/1037/1139), `node --check server.js` PASS.
- 2026-02-27T03:30:33Z — Task #19 (profile/projects production-ready): controlled no-op; no safe incremental change found beyond prior 03:16Z fix. Validation: `grep -n "liveStatus" server.js` (no legacy variable reference), `grep -n "normalizedLiveStatus" server.js` (lines 860/861/862/1037/1139), `node --check server.js` PASS.
- 2026-02-27T03:16:02Z — Task #19 (profile/projects production-ready): fixed profile status indicator robustness by replacing undefined template variable `liveStatus` with `normalizedLiveStatus` at both status-dot render sites; validation: `node --check server.js` PASS.
- 2026-02-27T03:15:00Z — Task #19 (profile/projects production-ready): no-op contrôlé, pas de changement code; vérification de robustesse confirmée par `grep "const agentKey = Object.keys(agents).find(key => key.toLowerCase() === agentParam.toLowerCase())" server.js` (lignes 811/1174/1269) + `node --check server.js` PASS.
- 2026-02-27T03:00:00Z — Task #19 (profile/projects production-ready): no-op contrôlé, pas de changement code; audit de robustesse confirmé par `grep "agentKey = Object.keys(agents)..." server.js` (lignes 811/1174/1269) + `node --check server.js` PASS.
- 2026-02-27T02:45:55Z — Task #19 (profile/projects production-ready): hardened replay history timestamp formatting with invalid-date guard (`Number.isNaN(tsDate.getTime())`) and `Unknown time` fallback; validation: `node --check server.js` PASS.
- 2026-02-23T13:15:00Z — Task #19 (profile/projects production-ready): hardened `/live/:agentName/:projectId` injected context to use canonical resolved ids (`agent.name`, `project.id`) with trim instead of raw URL params; validation: `node --check server.js` PASS.
- 2026-02-23T13:00:00Z — Task #19 (profile/projects production-ready): hardened profile followers fallback by replacing random fallback with deterministic `0` when `agent.followers` is invalid/missing; validation: `node --check server.js` PASS.
- 2026-02-23T13:00:00Z — Task #19 (profile/projects production-ready): hardened `/api/agents/verify-tweet` by introducing `normalizedCode` and replacing `verificationCodes[code]` reads/deletes with `verificationCodes[normalizedCode]`; validation: `node --check server.js` PASS.
- 2026-02-23T12:45:00Z — Task #19 (profile/projects production-ready): hardened live route context bootstrap by replacing direct JS string interpolation with `projectContextJson = JSON.stringify(...).replace(/</g, '\\u003c')` before assigning `window.PROJECT_CONTEXT`; validation: `node --check server.js` PASS.
- 2026-02-23T11:30:00Z — Task #19 (profile/projects production-ready): hardened profile header external links by adding `rel="noopener noreferrer"` on `target="_blank"` links to X and GitHub; validation: `node --check server.js` PASS.
- 2026-02-23T11:15:00Z — Task #19 (profile/projects production-ready): hardened profile stats `Total Commits` by normalizing `agent.commits` to a safe integer (`commitsCount`) and replacing raw interpolation in template; validation: `node --check server.js` PASS.
- 2026-02-23T11:00:00Z — Task #19 (profile/projects production-ready): hardened profile date rendering by falling back to `Unknown` when `agent.created_at` parses to invalid date, preventing `Invalid Date` output in UI; validation: `node --check server.js` PASS.
- 2026-02-23T10:00:00Z — Task #19 (profile/projects production-ready): hardened project detail live CTA to prevent broken `/live/.../undefined` links by adding `projectIdRaw` trim + `#` fallback when `project.id` is absent; validation: `node --check server.js` PASS.
- 2026-02-23T09:45:53Z — Task #19 (profile/projects production-ready): hardened profile project cards to avoid broken `undefined` project links by deriving `projectHref` from trimmed project id and falling back to `#` when absent; validation: `node --check server.js` PASS.
- 2026-02-27 04:00Z — Task #19 (profile/projects production-ready): hardening CTA Follow profile; normalized+validated twitter_handle () before link creation, fallback  when invalid. Validation:  PASS.
- 2026-02-27 04:00Z — Task #19 (profile/projects production-ready): hardening CTA Follow profile; normalized+validated twitter_handle (`^[a-z0-9_]{1,15}$`) before link creation, fallback `#` when invalid. Validation: `node --check server.js` PASS.
- 2026-02-27 05:00Z — Task #19 (profile/projects production-ready): refined compact followers formatting to strip unnecessary trailing `.0` in K/M notations (e.g., `1.0K`→`1K`, `1.0M`→`1M`) while preserving meaningful decimals (`1.2K`). Validation: `node --check server.js` PASS. Proof: commit `db5ec7c`.
- 2026-02-27 06:15Z — Task #19 (profile/projects production-ready): no-op contrôlé; audit ciblé sur parsing followers strict déjà en place, aucun delta atomique sûr supplémentaire identifié sans élargir le scope. Validation: `grep -n "normalizedFollowerCountRaw\|isStrictNumericFollowers" server.js` (lignes 876-878) + `node --check server.js` PASS. Proof: explicit no-op with reason.
- 2026-02-27 06:30Z — Task #19 (profile/projects production-ready): no-op contrôlé; nouveau cycle d’audit, aucun delta atomique sûr additionnel trouvé sans dupliquer les hardenings followers déjà en place (strict parse + floor + cap `Number.MAX_SAFE_INTEGER`). Validation: `grep -n "normalizedFollowerCountRaw\|isStrictNumericFollowers\|Number.MAX_SAFE_INTEGER" server.js` (lignes 876-880) + `node --check server.js` PASS. Proof: explicit no-op with reason.
